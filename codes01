#adatok=read.delim("/Users/eszterkriko/Downloads/gene_result.txt", header = TRUE, sep = "\t")
#colnames(adatok)
##########################innentol################################
adatok=read.csv("/Users/eszterkriko/Downloads/endogenous_human_retrovirus.csv")
colnames(adatok)
dim(adatok)
EntrezUID=adatok[,10]
write.table(EntrezUID, "/Users/eszterkriko/Downloads/EntrezUID_exosome.txt", sep="\t")
Identifiers=adatok[,"Identifiers"]
Identifiers=gsub('GeneID:','',Identifiers)
write.table(Identifiers, "/Users/eszterkriko/Downloads/Identifiers_exosome.txt", sep="\t")

###serveren#######
#R

adatok=read.csv("./endogenous_human_retrovirus.csv")
EntrezUID=adatok[,10]
write.table(EntrezUID, "./EntrezUID_exosome_t.txt", sep="\t")
write.table(EntrezUID, "./EntrezUID_exosome.txt", sep="\n")


##################

##minta####efetch -db protein -format fasta -id AEE52072.1,ADV47642.1 > my_seqs.faa

#names=readLines(EntrezUID_exosome.txt)
#efetch -db protein -format fasta -id $names

##############
cat(EntrezUID, sep=",") #hogy tudom kiírni?

export PATH=$PATH:/data/tools/edirect

#-db protein/gene/nuccore

efetch -db nuccore -format fasta -id 106128902,108004538,388560,100131068,100133791,100859922,111188137,111188141,111188142,111188143,111188144,111188145,111188146,111188147,111188148,111188149,111188150,110006328,105694156,106144559,106144560,106144561,106144562,106144563,106144564,106144565,106144567,106144571,106144572,106144576,106144579,106144580,106144581,106144583,106144587,106144589,106144597,106144603,106144604,106144605,106699568,106707175,100616443,100861467,100862686,100862687,100862689,339476,57612,100616106,100616107,100616108,100616199,100616412,100616462,51581,100862699,106144555,106144566,100862695,100862696,100616104,100862697,100862691,100862700,106144590,106144591,100616197,100616444,100616445,100862698,100616100,100616442,100289683,100616200,100616461,100616198,100616411,100862690,107986101,105376906,105375011,100862683,100862693,103539957,100533728,100887077,100887078,100862694,100616496,51359,100379323,100862688,107984203,107986113,100533725,100616105,100616446,105374013,105373297,105372481,100616102,100862684,60359,105372315,100616103,346547,100507321,619465,105372269,100616497,60358,85314,90625,100862685,105377641,449619,100288413,147664,100616101,100271846,100775105,405754,64006,2086,30816 > my_seqs.faa

ids=(106128902,108004538,388560,100131068,100133791,100859922,111188137,111188141,111188142,111188143,111188144,111188145,111188146,111188147,111188148,111188149,111188150,110006328,105694156,106144559,106144560,106144561,106144562,106144563,106144564,106144565,106144567,106144571,106144572,106144576,106144579,106144580,106144581,106144583,106144587,106144589,106144597,106144603,106144604,106144605,106699568,106707175,100616443,100861467,100862686,100862687,100862689,339476,57612,100616106,100616107,100616108,100616199,100616412,100616462,51581,100862699,106144555,106144566,100862695,100862696,100616104,100862697,100862691,100862700,106144590,106144591,100616197,100616444,100616445,100862698,100616100,100616442,100289683,100616200,100616461,100616198,100616411,100862690,107986101,105376906,105375011,100862683,100862693,103539957,100533728,100887077,100887078,100862694,100616496,51359,100379323,100862688,107984203,107986113,100533725,100616105,100616446,105374013,105373297,105372481,100616102,100862684,60359,105372315,100616103,346547,100507321,619465,105372269,100616497,60358,85314,90625,100862685,105377641,449619,100288413,147664,100616101,100271846,100775105,405754,64006,2086,30816)

ids=(106128902 108004538 388560 100131068 100133791 100859922 111188137 111188141 111188142 111188143 111188144 111188145 111188146 111188147 111188148 111188149 111188150 110006328 105694156 106144559 106144560 106144561 106144562 106144563 106144564 106144565 106144567 106144571 106144572 106144576 106144579 106144580 106144581 106144583 106144587 106144589 106144597 106144603 106144604 106144605 106699568 106707175 100616443 100861467 100862686 100862687 100862689 339476 57612 100616106 100616107 100616108 100616199 100616412 100616462 51581 100862699 106144555 106144566 100862695 100862696 100616104 100862697 100862691 100862700 106144590 106144591 100616197 100616444 100616445 100862698 100616100 100616442 100289683 100616200 100616461 100616198 100616411 100862690 107986101 105376906 105375011 100862683 100862693 103539957 100533728 100887077 100887078 100862694 100616496 51359 100379323 100862688 107984203 107986113 100533725 100616105 100616446 105374013 105373297 105372481 100616102 100862684 60359 105372315 100616103 346547 100507321 619465 105372269 100616497 60358 85314 90625 100862685 105377641 449619 100288413 147664 100616101 100271846 100775105 405754 64006 2086 30816)

ids=106128902 108004538 388560 100131068 100133791 100859922 111188137 111188141 111188142 111188143 111188144 111188145 111188146 111188147 111188148 111188149 111188150 110006328 105694156 106144559 106144560 106144561 106144562 106144563 106144564 106144565 106144567 106144571 106144572 106144576 106144579 106144580 106144581 106144583 106144587 106144589 106144597 106144603 106144604 106144605 106699568 106707175 100616443 100861467 100862686 100862687 100862689 339476 57612 100616106 100616107 100616108 100616199 100616412 100616462 51581 100862699 106144555 106144566 100862695 100862696 100616104 100862697 100862691 100862700 106144590 106144591 100616197 100616444 100616445 100862698 100616100 100616442 100289683 100616200 100616461 100616198 100616411 100862690 107986101 105376906 105375011 100862683 100862693 103539957 100533728 100887077 100887078 100862694 100616496 51359 100379323 100862688 107984203 107986113 100533725 100616105 100616446 105374013 105373297 105372481 100616102 100862684 60359 105372315 100616103 346547 100507321 619465 105372269 100616497 60358 85314 90625 100862685 105377641 449619 100288413 147664 100616101 100271846 100775105 405754 64006 2086 30816

for i in ids
do
efetch -db nuccore -id $i -format fasta >$
done

#####innentől lett jó#####
##########serveren###########start
##########download endogen retroviruses###########
#R

ids=("106128902 108004538 388560 100131068 100133791 100859922 111188137 111188141 111188142 111188143 111188144 111188145 111188146 111188147 111188148 111188149 111188150 110006328 105694156 106144559 106144560 106144561 106144562 106144563 106144564 106144565 106144567 106144571 106144572 106144576 106144579 106144580 106144581 106144583 106144587 106144589 106144597 106144603 106144604 106144605 106699568 106707175 100616443 100861467 100862686 100862687 100862689 339476 57612 100616106 100616107 100616108 100616199 100616412 100616462 51581 100862699 106144555 106144566 100862695 100862696 100616104 100862697 100862691 100862700 106144590 106144591 100616197 100616444 100616445 100862698 100616100 100616442 100289683 100616200 100616461 100616198 100616411 100862690 107986101 105376906 105375011 100862683 100862693 103539957 100533728 100887077 100887078 100862694 100616496 51359 100379323 100862688 107984203 107986113 100533725 100616105 100616446 105374013 105373297 105372481 100616102 100862684 60359 105372315 100616103 346547 100507321 619465 105372269 100616497 60358 85314 90625 100862685 105377641 449619 100288413 147664 100616101 100271846 100775105 405754 64006 2086 30816")
ids

new=gsub(" ", "\n", ids)
write(new, "./entrez_ids.txt", sep="\n")


#bash

while read -r line
do
efetch -db nuccore -format fasta -id $line
done < entrez_ids.txt

#vagy##
while read -r line
do
efetch -db nuccore -format fasta -id $line >$line.fa
done < entrez_ids.txt

#######download exosome data#########
# Stop on any error. Print the commands as they execute.
#set -uex
# NCBI BioProject ID.
#PRJN={{bioproject.value}}
#
# How many sequencing runs to get for the project.
#RUNS={{runs.value}}
#
# How many reads to download from each run.
#READS={{reads.value}}
#
# Obtain the run information.
#esearch -db sra -query $PRJN | efetch -format runinfo > runinfo.csv
#
# Obtain the first few SRR numbers.
#cat runinfo.csv | cut -f 1 -d , | grep SRR | head -$RUNS > runids.txt
#
# Create a directory for the sequencing data.
#mkdir -p reads

# Download the FASTQ data for each SRR number.
cat runids.txt | parallel fastq-dump --split-files -X $READS -outdir reads {}

####

#
mkdir exosome_data
cd exosome_03/exosome_data

#esearch -db sra -query $PRJN | efetch -format runinfo > runinfo.csv
#cat runinfo.csv | cut -f 1 -d , | grep SRR  > exosome_ids.txt

#PRJN=(PRJNA475497 PRJNA526037)

#export PATH=$PATH:/data/tools/edirect

#for PRJNA in "${PRJN[@]}"
#do
#esearch -db sra -query $PRJNA | efetch --format runinfo |cut -d "," -f 1 > exosome_ids.txt
#done

#esearch -db sra -query $PRJNA | efetch --format runinfo |cut -d "," -f 1 > exosome_ids.txt

#while read -r line
#do
#efetch -db nuccore -format fasta -id $line >$line.fa
#done < exosome_ids.txt

cd exosome_03/exosome_data
export PATH=$PATH:/data/tools/sratoolkit.2.9.2-ubuntu64/bin

while read -r line
do
nohup fastq-dump $line 
done < exosome_ids.txt

#ez kellett
#sed '1d' exosome_ids.txt 

PRJN=(PRJNA475497 PRJNA526037)
for PRJNA in "${PRJN[@]}"
do
fastq-dump $line >$line.fa
done

#NCBI efetc
#SRA fastq-dump
##########serveren###########end

####kraken_build_db#######nem ezzel dolgoztam#########+
#
#kraken-build --download-taxonomy --db $DBNAME

kraken-build --download-taxonomy --db $RETROVIRUSDB


for file in *.fa
do
    kraken-build --add-to-library $file --db $RETROVIRUSDB
done


kraken-build --build --db $kraken-build --build --db $DBNAME
#############################

#######STAR########
#
#########CAT egybe illeszteni#########
#
#bash
#cat File1.txt File2.txt > union.txt
#STAR -- runMode genomeGenerate \
     -- genomeDir STARindex \
     -- genomeFastaFiles *.fa \
     -- sjdbGTFfile Saccharomyces_cerevisiae.R64-1-1.95.gtf \
     -- runThreadN 1 
     
     
mkdir STARindex

cp *.fa ./STARindex
cd STARindex

#cat *.fa > all_endogen_retrovirus.fa

export PATH=$PATH:/data/tools/STAR/bin/Linux_x86_64

##INDEX###STAR###

cd STARindex
export PATH=$PATH:/data/tools/STAR/bin/Linux_x86_64

STAR -- runMode genomeGenerate \
     -- genomeDir ./ \
     -- genomeFastaFiles ./*.fa \
     -- runThreadN 1 
     
#itt egy genome indexet generáltunk, tehát ez egy genomeot tartalmaz   
ls -lh

##illesztes######STAR

export PATH=$PATH:/data/tools/STAR/bin/Linux_x86_64

cd /exosome_03

STAR -- genomeDir STARindex \
     -- readFilesIn ./exosome_data/*.fastq \
     -- outFileNamePrefix mapped \
     -- outFilterMultimapNmax 1 \
     -- outReadsUnmapped Fastx \
     -- twopassMode Basic \
     -- runThreadN 1 

ls -lh
